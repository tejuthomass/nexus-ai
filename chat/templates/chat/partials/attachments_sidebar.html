<!-- Right Sidebar - Attachments Pane -->
<div class="w-[280px] bg-[#171717] flex flex-col border-l border-white/5 hidden lg:flex">
    <div class="p-4 border-b border-white/5">
        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider flex items-center gap-2">
            <i class="fas fa-paperclip"></i>
            Attachments
        </h3>
    </div>
    
    <!-- File Upload Section -->
    <div class="p-3 border-b border-white/5">
        <form id="pdf-upload-form" 
              hx-post="{% url 'chat_session' session.id %}" 
              hx-encoding="multipart/form-data"
              hx-target="#attachments-list"
              hx-indicator="#sidebar-upload-indicator"
              hx-on::before-request="disableChatInput()"
              hx-on::after-request="enableChatInput(); this.reset(); updateFileLabel('');"
              class="space-y-2">
            {% csrf_token %}
            
            <!-- Upload Indicator -->
            <div id="sidebar-upload-indicator" class="htmx-indicator mb-2 p-2 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                <div class="flex items-center gap-2 text-xs">
                    <i class="fas fa-circle-notch fa-spin text-blue-400"></i>
                    <span class="text-blue-300">Processing PDF...</span>
                </div>
            </div>
            
            <!-- Upload Button -->
            <label for="sidebar-pdf-upload" class="flex items-center justify-center gap-2 px-3 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg cursor-pointer transition-all duration-200 text-sm font-medium">
                <i class="fas fa-upload"></i>
                <span>Upload PDF</span>
            </label>
            <input type="file" 
                   id="sidebar-pdf-upload" 
                   name="pdf_file" 
                   accept=".pdf" 
                   class="hidden"
                   onchange="updateFileLabel(this.files[0]?.name || ''); this.form.dispatchEvent(new Event('submit', {bubbles: true}));">
            
            <!-- File Info -->
            <div id="file-label" class="text-xs text-gray-500 text-center min-h-[16px]"></div>
            
            <!-- Size Limit Info -->
            <div class="text-xs text-gray-600 text-center">
                <i class="fas fa-info-circle"></i> Max size: 10MB
            </div>
        </form>
        
        <!-- Error/Success Messages -->
        <div id="upload-message" class="mt-2"></div>
    </div>
    
    <!-- Attachments List -->
    <div id="attachments-list" class="flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar">
        {% include 'chat/partials/attachments_list.html' with documents=documents %}
    </div>
</div>

<script>
function updateFileLabel(filename) {
    const label = document.getElementById('file-label');
    if (filename) {
        label.textContent = filename.length > 25 ? filename.substring(0, 25) + '...' : filename;
        label.classList.add('text-green-400');
    } else {
        label.textContent = '';
        label.classList.remove('text-green-400');
    }
}

function disableChatInput() {
    const textarea = document.querySelector('textarea[name="message"]');
    const submitBtn = document.querySelector('button[type="submit"]');
    if (textarea) {
        textarea.disabled = true;
        textarea.placeholder = "Processing PDF, please wait...";
    }
    if (submitBtn) {
        submitBtn.disabled = true;
    }
}

function enableChatInput() {
    const textarea = document.querySelector('textarea[name="message"]');
    const submitBtn = document.querySelector('button[type="submit"]');
    if (textarea) {
        textarea.disabled = false;
        textarea.placeholder = "Message Nexus...";
    }
    if (submitBtn) {
        submitBtn.disabled = false;
    }
}
</script>
